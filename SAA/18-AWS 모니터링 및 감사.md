



## AWS Cloudwatch Metrics - 클라우드워치 지표

- `AWS의 모든 서비스에 대한 메트릭(지표)`를 제공함
  - 메트릭 = 모니터링 할 변수 ( Ec2의 CPU사용율,네트워크 in 패킷 등)
  - 메트릭은 namespaces에 속하므로, 각기 `다른 이름 공간에 메트릭이 저장 됨`
  - 서비스당, namespaces는 `하나임`
    - 예를 들어, 모든 Ec2의 CPU사용률 평균은 `CPUUtilization: Average` 이름에 저장됨
- 메트릭당 최대 10개의 차원 
- 메트릭은 반드시 타임 스템프를 가짐 ( 시간데이터니깡 )
- 사용자 지정 메트릭스도 만들 수 있음
- 메트릭은 Streams로 -> `키네시스 Data firehose, datadog 등 전송 할 수 있음`


--------------------------


## AWS Cloudwatch Logs- 클라우드워치 로그

- `로그와 매트릭을 헷갈리면 안됨!`
- `log groups` 애플리케이션 로그들은 로그그룹화 됨
- `log stream` 하나의 로그라고 보면됨 (로그파일/애플리케이션 리소스 등)
- 로그들을 만료하지 않게 `정책` 설정 가능(기본은 만료됨 )
- 로그 전송 (외부 저장공간 및 응용)
  - S3 -> `실시간이 아니고, 12시간 까지 걸릴수 있음`
    - 실시간으로 받으려면 `subscription filter`(구독 필터)를 설정 해야됨
  - 키네시스 스트림
  - 키네시스 파이어호스
  - AWS lambda
  - 오픈서치

![Alt text](../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EC%99%80%EC%B9%98%EA%B5%AC%EB%8F%85%ED%95%84%ED%84%B0.png)

- subscription filter는 여러 리전의 로그들을 한곳에 모을 수도 있음
  - `여러 AWS 계정 log 통합도 가능`

![Alt text](../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EC%99%80%EC%B9%98%EA%B5%AC%EB%8F%85%ED%95%84%ED%84%B02.png)




로그 소스
- SDK, cloudwatcg logs agent, cloudwatch unified agent
- beanstalk -> 애플리케이션 로그를 모아서 전송
- ecs -> 컨테이너 로그
- lambda -> 람다 실행 로그
- VPC flow logs -> vpc 트래픽 로그
- api gateway -> 받은 모든 요청 로그
- cloudtrail  -> 필터링한 로그들 받을 수 있음
- route53 -> 모든 DNS 쿼리를 로그로 받을 수 있음



매트릭 & 로그 필터/인사이트
- 지표,매트릭 모두 필터링해서 사용 할 수 있다
  - 로그에서 특정 IP를 찾는다던지
  - 특정 메세지에 "ERROR"라는 문구가 있는지
- 필터를 통해 `클라우드워치 알람`과 연동 가능
- `log 인사이트를 통해 SQL검색 가능`, 자주 쓰이는 쿼리 저장



-------------------------------------------------------

## AWS Cloudwatcg logs agent, Cloudwatch unified agent

- 기본적으로 Ec2의 로그는 안받아옴 -> Ec2에 cloudwatch 에이전트 깔면 보임 (온프라미스 장비도 설치하면, 가능)
- IAM에서 로그를 보낼수있게 역할을 만들어 줘야함


에이전트는 2가지 종류가 있음
- logs agent
  - 오래된 에이전트이고, `오로지 로그만 보냄`
- unified agent
  - `Ram, 로그, 프로세스 등` 추가적인 정보도 함께 보냄
  - `매트릭 정보와 로그`를 둘다 사용하기 때문에 `통합 에이전트`라고 하는것임
  - SSM parameter store를 이용해, 쉽게 에이전트 구성 가능?
  - 세부 지표를 얻으려면, `무조건 클라우드 와치 통합 에이전트 깔것`



-------------------------------------
## AWS CloudWatch Alarms

- 알람은 오직 `매트릭`에서 트리거 가능
  - 로그를 트리거 하려면, 로그 -> 매트릭 변환 후 -> 알람 설정
- 알람 상태
  - OK
  - INSUFFICIENT_DATA (데이터 부족)
  - ALARM (알람 알람~)
- preiod (평가 기간)
  - 내맘대로 설정 할수있음, 5분 10분 등

- 주 타겟
  - Ec2, 오토스케일링 그룹, SNS

- AWS CLI 명령어를 통해, 알람을 임시로 발생 시킬수도 있음

--------------------
 ## AWS Event Bridge


- 이벤트 버스를 생성해 운영 하는 방식
- `AWS말고, 외부 제품 이벤트랑 연동` 
- `서버리스`
- `이벤트를 아카이빙 할 수 있음(저장)`
  - 아카이브된 이벤트, 재생도 가능함
- 이벤트는 `Json형식`으로 발생
- `이벤트 룰`(트리거) 2종류
  - 스케쥴 기반 = cronjob
    - 예) 1 시간 마다 특정 람다함수 호출, 루트 유저 접속할때마다 이메일 보내기 등...
  - 이벤트 기반
    - 예) IAM 접속 -> 트리거해서 SNS 이메일 날림 
- `이벤트 정책`을 통해, 다른 AWS 계정의 이벤트를 `내 이벤트 버스`로 통합 시킬 수 있음 (정책 없으면, 내 이벤트만 컨트롤)
<br>
<br>

이벤트 버스 종류
- default event 버스 
  - 다른 이벤트 버스들 안쓰면, 클라우드 와치 이벤트와 똑같다
- 파트너 이벤트 버스 
  - `datadoc`, zendsk 등 이벤트를 받을 수 있다
- 사용자 이벤트 버스 
  -  사용자의 애플리케이션 이벤트용
- 스키마 레지스트리
  - 스키마 모델을 설정 가능

<br>
<br>
<br>

---------------------------------------
## AWS CloudWatch insights and operational visibility (인사이트 및 운영 가시성?)































































