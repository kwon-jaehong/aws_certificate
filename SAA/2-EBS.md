
## EBS

- 인스턴스가 실행 중인 동안, `연결 가능한 네트워크 드라이브`
  - `EBS는 물리적 드라이버가 아니라!!!! 네트워크 드라이버다!!!!!`
- ec2 인스턴스가 종료 되더라도, `데이터를 유지 가능`
- EBS는 ec2에 일부 다중연결이 가능함  
- EBS는 AZ에 종속된다. (인스턴스에 붙여야되니까... 종속적임)
  - us-east-1a에서 생성된 EBS는 us-east-1b에는 있는 EC2와 연결 불가능
- 하지만 `EBS 스냅샷을 사용하면` 다른 AZ에 연결 가능함
- EBS는 네트워크 드라이버라, `ec2인스턴스에서 분리 될 수 있고, 다른 ec2에 연결 가능하다`
- 프리티어는 `매달 30GB` GP2 또는 GP3
- 원하는 디스크, IOPS를 결정해야됨
  - 어짜피 용량은 나중에 늘릴 수 있음
- 기본적으로, ec2 인스턴스가 종료되면 EBS는 삭제-> 설정으로 취소할 수 있음!!! (시험 나올수 있음) 

<br>
<br>
<br>

------------

<br>

## EBS 스냅샷
- `원하는 시점`의 EBS 백업 `저장소`
- EBS 스냅샷은, 꼭 필요는 없지만, 권장사항임
- 스냅샷은 `다른 리전 & AZ에 복사 할 수 있음`
- `스냅샷은 점진적으로 저장되므로 저장된 변경된 블록에 대해서만 비용이 청구됩니다.`


EBS 스냅샷 아카이브
- EBS 스냅샷 아카이브는 S3와 S3 글래셔라고 생각하면됨
- 아카이브 저장소가 75% 쌈, 단 아카이브에서 복구하는데 24~72시간 걸림 (즉시 복원 X)

recycle bin (EBS 스냅샷 휴지통)
- `보존 규칙 생성`으로 `활성화` 해줘야함
- EBS 스냅샷을 영구 삭제하는 대신에, 휴지통에 넣을 수 있음
- 보관기간은 1일 ~ 1년으로 설정할 수 있음


Fast snapshot restore (FSR) - 빠른 스냅샷 복원
- 스냅샷이 아주 크고, 인스턴스를 빠르게 초기화 해야할 때 사용,
- 졸라 비쌈 


![Alt text](../etc/image2/ebs%EC%8A%A4%EB%83%85%EC%83%B7.png)

<br>
<br>

--------

## AMI 
- 아마존 머신 이미지 , ec2 시작시, os 부터 소프웨어까지 니 맘대로 설정 가능함
- 특정지역에서 구축한 이미지를, `다른 지역으로 복사해서 AWS 글로벌 인프라`를 활용 할 수 있음
- 마켓 플레이스에서 검색도 가능

AMI는 ec2 인스턴스에서 어떻게 처리 되나?
- 먼저 ec2인스턴스를 원하는 대로 설정해 줌
- 인스턴스를 중지해, 데이터 무결성을 확보함
- 이 인스턴스를 바탕으로 AMI를 빌드함 (이 과정에서 EBS 스냅샷이 생성됨)
- 그럼 다음 AMI으로 인스턴스를 실행 할 수 있음


<br>
<br>

-------------

## instance store - 인스턴스 스토어
<br>
<br>

- 기존, EBS는 성능이 제한되어 있음 (읽기 속도,쓰기 속도)
- 특정 유형의 Ec2인스턴스에 해당하는 `물리적 서버에 연결된 하드웨어 디스크`를 가르킴
- 하지만 `ec2 인스턴스를 중지하면 디스크에서 데이터 사라짐` (장기적인 데이터 보관소는 절대 아님!)
- `버퍼, 캐시, 비정형 데이터` 일때 사용하는 것이 좋음
- 물리적으로 연결되있으므로 장애 발생시, 데이터 손실 위험이 있음
- `i3시리즈`가 인스턴스 스토어를 사용함




![Alt text](../etc/image2/%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EC%8A%A4%ED%86%A0%EC%96%B4.png)

- 인스턴스 목록이 구지.... 시험에는 안나옴



참고:
      
https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/InstanceStorage.html

<br>
<br>


--------------------------------
## AWS EBS 볼륨 타입

- 총 6개의 유형이 있음
- 시험에는 `gp2와, IOPS 프로비저닝이 가장 많이 나옴`
- gp2/gp3
  - `범용 SSD`, 다양한 워크로드에 대해 `가격과 성능이 적절함`
  - 디스크 크기는 1GB ~ 16TB까지
  - gp2
    - 작은 용량을 프로비저닝 했을때는, 최대 성능 `3000 IOPS`
    - `볼륨 사이즈와 IOPS가 선형적으로 증가함` ㅋㅋ -> `최대 16000`
    - `1기가 = 3 IOPS 증가` -> 볼륨이 1기가 증가 할 때 마다, 3 IOPS 증가함
    - 만약 5334GB를 프로비저닝 했다면, 16000 IOPS를 달성한 것임
  - gp3
    - `최신 세대 범용 SSD`
    - `기본` 성능으로 `3000 IOPS`와 `125 MiB/s` 초당/처리량을 보여줌
    - 옵션에 따라, `16000 IOPS`와 `1000 MiB/s` 까지 증가 시킬수 있음!!!
    - `gp2처럼` 볼륨 크기와 IOPS는 `상관없음` 
- io1/io2 
  - `고성능 SSD`, 적은 시연시간, 대용량 워크로드가 중요할 떄 쓰임 ( `DB에 최고!!!`)
  - `16000 IOPS`의 이상을 요하는 애플리케이션에 적합 
  - `EBS 멀티 연결 지원 볼륨임`
  - 디스크 크기는 `4GB ~ 16 TB`
    - gp2와 마찬가지로 저 둘은 `1기가 = X IOPS 증가` 매커니즘을 가짐
    - 보통 ec2 인스턴스는 `최대 32000 IOPS`, `Nitro Ec2 인스턴스`에서는 `최대 64000 IOPS`까지 가능
    - `io2는` io1보다 `기가당 IOPS의 수가 더 높음`
  - io2 block Express (4 GB ~ 64TB)
    - 고성능 유형의 볼륨, 지연시간이 밀리초 미만
    - Max PIOPS 256000, `1기가 = 1000 IOPS 증가`
- st1 / sc1
  - 디스크 크기는 125Mib ~ 16TiB
  - `절대!!! ec2의 부트 볼륨이 될 수 없음`
  - st1
    - `HDD, 낮은 가격,` 잦은 접근과 잦은 처리량이 많은 워크로드에 쓰임 
    - 데이터 웨어하우징, 빅데이터, 로그처리에 적합
    - 초당 500Mib 처리량, 최대 IOPS 500
  - sc1
    - 낮은 빈도 데이터 처리...
    - `HDD, 가장 적은 비용` , 성능 구림
    - 초당 250Mib 처리량, 최대 IOPS 250


요거... 표정리 하자!!!!!!

-------------------------

## EBS multi-attach (EBS 다중 연결)
- `같은 AZ`에 존재하는 `여러 Ec2인스턴스`에 EBS 다중 연결, `io1/io2` 만 가능
  - `다른 AZ로 연결 불가임`
- 각 인스턴스는 고성능, 볼륨에 대한 읽기 및 쓰기 `권한을 전부 갖는다` -> 동시에 읽고 쓸 수 있다
- 다중연결의 제한은 `최대 16개 Ec2만` 연결 가능
- 반드시 OS의 `클러스터 인식 파일 시스템`을 사용해야됨 ( EX4,XFS,etc... 이런 일반적인 파일시스템은 안됨)
- 사용사례
  - 애플리케이션이 동시 쓰기 작업을 관리해야 될때,



-----------------------
## EBS Encryption - EBS 암호화
- 기본적으로 EBS 암호화는 `비활성화`임
- 먼저 EBS볼륨을 생성하면 다음과 같은 일이 일어난다
  - 저장 데이터가 볼륨 내부에 암호화
  - 인스턴스와 EBS 볼륨간의 전송 데이터 역시 암호화됨 
  - 모든 스냅샷도 암호화
  - 스냅샷으로 생성한 EBS 볼륨도 암호화됨
- 이때, 암호화 및 복호화 매커니즘은 `고객이 볼 수없음` -> 백그라운드에서 ec2와 ebs가 모두 핸들링함
- 암호화는 지연시간에 아주 적은 영향을 주긴함 (minimal impact on latency)
- EBS는 AWS KMS에서 TLS 세션을 통해 `KMS 키로 암호화된 볼륨 키를 가져오고 암호화된 키를 볼륨 메타데이터와 함께 저장`


EBS 볼륨 암복호 예시
- 암호화 `비활성화된` EBS 볼륨 스냅샷 생성 (`스냅샷 생성때도 암호화는 안됨`)
- 만들어진 스냅샷을 복사 -> 스냅샷을 복사할때 `암호화 활성`,복사할 리전, KMS키도 선택 
- 복사된 스냅샷을 이용해 `새 EBS`를 생성하면, 해당 EBS도 암호화 됨
- 암호화된 볼륨을 인스턴스 원본에 연결




-----------------------
## EFS - Elastic File System

<br>

- 파일 네트워크 시스템 ( 일종의 공유되는 폴더나 하드라고 생각하면됨 )
- EFS 하나가 수백개의 EC2에 연결 될 수 있음
- EFS는 `리눅스 인스턴스`만 사용할 수 있고, 멀티 AZ가 가능함
- 대신, EBS 3배가량 비쌈, 단, 사용량에 따라 비용 지불
- EFS 이더넷 카드로 마운트 가능 (설명 보충해야됨)
- `온프레미스 리소스와 함께 사용할 수 있음`

<br><br><br>

### EFS-IA (infrequent access)
- 파일 엑세스 빈도에 따라 EFS에서 파일을 EFS-IA로 이동시킴
- 그냥 EFS보다 92프로 쌈 -> 걍 EFS계의 s3 글래셔
- Infrequent Access 스토리지 클래스 비용은 Standard보다 저렴하며 `파일을 읽거나 쓸 때마다` 요금을 지불합니다.

<br><br>

--------------------

## EBS 공동 책임 모델

<br><br>

### AWS 책임
- EBS,EFS 하드웨어를 복제를 실행하거나, 작동하지 않으면 AWS 책임

<br><br>

### 고객 책임
- 데이터 손실되지 않게 백업,스냅샷 뜨는건 내책임
- 데이터 암호화도 내책임
- 드라이브에 설정하는 모든 데이터는 내책임
- 인스턴스 스토어 스토리지에 대한 이해 내책임

<br>
<br>

---------------------

## AWS FsX
- AWS에서 타사의 고성능 파일 시스템을 얻는 관리형 서비스
- 고성능 파일 시스템임!!!!!
- GCP나 애져 스토리지 연동 서비스 인듯 X
- 윈도우 파일서버, 리눅스 클러스터 서버 -> HPC나 기업에서 사용하기 적당함
- 이거 왜씀? -> EFS나 EBS는 AWS 인스턴스 대상이지만, Fsx는 내컴퓨터에서도 접근 가능하기 때문임

