## AWS 보안

- `시험에 보안에 관한 문제가 많이 출제됨`
- cloudHSM은 시험범위에 없음


---------------
## AWS KMS (aws key management service)

- 시험문제에서 서비스에 관한 `대부분 암호화는 KMS임`
- AWS KMS는 주로 데이터 암호화 키 및 기타 AWS 리소스의 관리에 사용됩니다.
- KMS 키를 사용하기 위한 API호출을 `Cloudtrail에서 볼 수 있음`




<br>

<br>
<br>



- KMS 키 암호화 종류 (2가지)
  - 대칭키 - Symmetric (AES-256 키)
    - 키가 `하나임`
    - `데이터 암/복호화에 사용`
    - `키에 절대 접근 할 수 없고`(내용을 볼수없고), 사용하려면, 무조건 KMS API 콜 해야됨
  - 비대칭키 - Asymmetric (RSA & ECC 키) (`SAA 시험에 안나옴`)
    - 키가 `2개임` (퍼블릭 키, 프라이빗 키)
    - KMS에서 퍼블릭키는 다운 받을수 있지만, `프라이빗 키에는 엑세스 불가`
    - AWS 클라우드 외부에서 암호화 할때 사용

- KMS 키 유형 (3가지)
  - 10000번 API 콜에 0.03달러
  - `AWS Managed Key`
    - 무료
    - 이름은 `aws/서비스 이름`
    - rds, ebs (aws/rds , aws/ebs 이름으로 키생성됨)
    - `자동으로 1년에 한번씩 교체됨`
  - `CMK`
    - 고객이 AWS KMS에서 키를 생성할 경우 (`Customer managed Keys`)로 할 경우 1달러/1달 비용 발생
    - CMK 사용하려면, `반드시 1년에 한번 교체되도록 활성화` 해야됨
      - `교체 빈도 수정 불가!`
  - `CMK imported`
    - 고객이 키 자체를 입력(256비트 문자열)을 입력해서 키 생성, CMK적용되어 1달러/달 비용 발생
    - `오직 수동으로만 키 교체`


- KSM은 리전에 따라 다름
  - 서울 리전은 키A, 스톡홀름 리전 키B라고 가정
  - 아래 그림은 EBS스냅샷을 다른곳으로 복사할때 발생하는 일임
  - 스냅샷 이동할때 -> 즉, 키A로 복호화, `키B로 암호화를 함` ( AWS에서 `자동으로 처리`)

![Alt text](../etc/image2/KMS%EC%8A%A4%EB%83%85%EC%83%B7%EC%9D%B4%EB%8F%99.png)



- KMS 키 정책
  - `KMS 키 정책`이 없으면, 누구도 `접근 불가능`
  - KMS 키관련, 2가지 정책이 있다
    - Default KMS Key policy
      - 기본 정책은 `고객이 KMS 키정책을 따로 만들지` 않는한, 이 정책이 적용됨
      - 계정의 `모든 유저가 키에 엑세스 허용`
    - Custom KMS key policy
      - KMS키에 엑세스 할 수있는 사용자, 또는 역할을 정의
      - KMS키에 관한 cross-account access (`다른 AWS계정에서 내계정 키 엑세스 허용`)할때 매우 유용
      - cross-account access 언제사용하나?
        - 계정간 스냅샷을 복사할때 사용

![Alt text](../etc/image2/KMS%EA%B3%84%EC%A0%95%EA%B0%84%EC%8A%A4%EB%83%85%EC%83%B7%EB%B3%B5%EC%82%AC.png)


------------------------------------------------------
## AWS KMS Multi-Region key 멀티리전키

- KMS 키는(기본값인, AWS 관리형) `기본적으로 리전 단위`
- 하지만 키를 `고객이 생성`할 경우, 멀티 리전으로 만들 수 있다.
  - 하나의 `키가 복사`되는것임
- 원본 키를 `자동 교체(1년주기)`로 교체하면, 다른것들도 `자동으로 바뀜`


- 하지만, `다중 리전 키는 전역적으로 사용할 수 없다`
  - 각 복사본 키들은, 각 리전에서 `독립적으로 관리`된다 (복사는 되었더라도 정책을 일일이 관리해줘야한다) `키를 하나라고 생각 해서는 안된다!`
- 다중 리전키 사용은... 권장하지는 않음

![Alt text](../etc/image2/KMS%EB%A9%80%ED%8B%B0%EB%A6%AC%EC%A0%84%ED%82%A4.png)




- 예시)  한 리전에서 스냅샷 암호화 -> 다른 리전에서 스냅샷 복호화
  - `글로벌 다이나모, 오로라 DB 테이블 암호화`








































