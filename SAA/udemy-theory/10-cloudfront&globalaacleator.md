## AWS Cloudfront

<br><br>

- CDN( global content delivery network ) 서비스임
- 여러 엣지 로케이션에 있는 웹사이트의 콘텐츠를 캐싱(이미지나 동영상)하여 읽기 능력을 향상
- 사용자를 최소한의 지연시간으로 가장 가깝게 배포 리전에 라우팅 하도록 함
- 엣지 로케이션에 데이터들을 복제해 일반요청을 캐시해서 레이턴시를 낮춤
- 전 세계, 216개의 엣지 로케이션이 존재 (계속 추가중임)
- `DDos 공격 대비`
- `캐싱 대상`
  - s3 버킷
  - 웹사이트 (`ec2, ELB` , s3 정적 웹페이지)
- 동작방식 -> 에지로케이션 캐시에 없다면 원본에서 자료를 가져옴 (하루정도 로케이션에 캐싱됨)
- 클라우드프론트가 S3버킷에 접근할 수 있게, `버킷정책` 업데이트 해줘야함
- `정적 콘텐츠와 동적 콘텐츠를 모두 배포 가능`

<br><br><br>

![Alt text](../../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%84%EB%A1%A0%ED%8A%B81.png)


<br><br><br>

origins `(원본 제공 방식)`
- S3 버킷
  - S3 버킷 내용을 Cloudfront를(에지 로케이션에서) 통해 파일을 분산하고, 캐싱 할 수 있게 함
  - Cloudfront `origin Access control` (`OAC` - 원본 접근 제어)를 통해 `향상된 보안을 제공`
  - OAC가 `OAI`(origin access identity - 원본 액세스 ID)를 `대체`합니다
  - Cloudfront는 ingress를 통해 S3에 파일 `업로드`도 가능하다

<br><br>

- Custom origin (HTTP)
  - 예시) `애플리케이션 로드 밸런서나, Ec2, S3 정적 웹사이트, any HTTP`
  - 커스텀이기에 OAI, OAC같은 `보안 컨트롤은 없음`



<br><br>

- 오리진 프로토콜 정책
  - 배포의 해당 오리진에 대해 오리진 프로토콜 정책을 변경합니다.<br><br><br>

  - `HTTPS만(HTTPS Only)` - CloudFront에서 사용자 지정 오리진과 통신할 때 HTTPS만 사용합니다.
  - `최종 사용자와 일치(Match Viewer)` - CloudFront에서 최종 사용자 요청의 프로토콜에 따라 HTTP 또는 HTTPS를 사용하여 `사용자 지정 오리진과 통신`합니다. 
    - 예를 들면 오리진 프로토콜 정책(Origin Protocol Policy)에 최종 사용자와 일치(Match Viewer)를 선택하고 최종 사용자가 HTTPS를 사용하여 CloudFront에서 객체를 요청하는 경우, CloudFront에서도 HTTPS를 사용하여 해당 요청을 오리진으로 전달합니다.

<br><br>

- 최종 사용자가 HTTP 및 HTTPS 프로토콜 모두를 사용하여 요청하더라도 CloudFront에서는 한 번만 객체를 캐싱합니다.

<br><br>

- 오리진 SSL 프로토콜
  - 배포의 해당 오리진에 대해 오리진 SSL 프로토콜을 선택합니다. SSLv3 프로토콜이 덜 안전하므로 사용자가 TLSv1 이상을 지원하지 않는 경우에만 SSLv3을 선택하는 것이 좋습니다. TLSv1 핸드쉐이크는 SSLv3의 이전 버전 및 이후 버전과 모두 호환되지만, TLSv1.1 및 TLSv1.2는 호환되지 않습니다. SSLv3을 선택하면 CloudFront는 SSLv3 핸드셰이크 요청만 보냅니다.

<br><br><br>

![Alt text](../../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%84%EB%A1%A0%ED%8A%B82.png)

<br><br><br>


`S3 CRR(리전 복제)랑 클라우드프론트랑 뭐가 틀리나?`
- 클라우드 프론트는 전세계 엣지네트워크를 사용하여 `요청 파일을 캐싱`해둠
- `전세계를 대상으로, 정적 컨텐츠`를 사용하고자 할때 사용
- S3 CRR은 일부 리전을 대상으로, `동적 컨텐츠`를 낮은 지연시간으로 제공할때 쓰는것


<br><br><br><br>





ALB 또는 Ec2 원본 제공 방식
- 클라우드 프론트가 Ec2에 접근하려면 Ec2의 보안그룹에 `클라우드 프론트 IP를 허용` 해줘야한다 
- ALB도 마찬가지로 보안그룹 허용해줘야 클라우드프론트가 참조할 수 있다.

<br><br><br><br>

클라우드 프론트 `지리적 제한` 설정
- 사용자 지리적 특성에 따라, `허용 리스트&블랙 리스트` 관리 가능
- geo-ip(서드파티 ip DB - 사용자 ip로 해당국가 알수 있음)
- 사용예는 특정국가에 컨텐츠 저작권법 같은 제한이 있는경우 사용함

<br><br><br><br>


클라우드 프론트 pricing
- 클라우드 프론트는 글로벌 서비스이다. -> `엣지 로케이션마다 트래픽 비용이 다름`
- 그래서 엣지 로케이션을 선택할 수있음
  - 옵션1. 다씀
  - 옵션2. 클래스 200 -> 대부분쓰고, 가장 비싼 리전 제외
  - 옵션3. 클래스 100 -> 절반만쓰고, 대부분 저렴한 리전임

<br><br><br><br>


캐시 무효화
- 클라우드 프론트에는 항상 백엔드 오리진(`원본`)이 있음
- 원본이 업데이트 되면, TTL에 따라 클라우드프론트에 `업데이트가 실시간 적용`이 안될수있음
- 캐시를 다시하는것이고, (/image/*)처럼 와일드 카드를 사용해서 캐시 무효화 대상을 선택함





<br><br><br><br>




--------------------------
## Global applications Architecture


Unicast IP
- 하나의 서버가, 하나의 IP를 가짐

Anycast IP
- `모든 서버가 하나의 IP를 가짐`
- 클라이언트에서 가장 가까운 서버랑 연결됨


![Alt text](../../etc/image2/%EC%95%A0%EB%8B%88%EC%BA%90%EC%8A%A4%ED%8A%B8.png)




- 글로벌엑셀레이터는 `애니캐스트`를 사용
- AWS 내부 네트워크를 통해(`엣지 로케이션`)을 통해 AWS 리소스에 접근
- 글로벌 악셀을 사용하면, `고정 아이피 2개가 생성`
- 지연시간이 적음
- `EIP,EC2,ALB,NLB`, 또는 사설&공용 IP
- `DDos 보호`도 자동으로 받게됨 (쉴드 자동 탑재)
- `헬스체크 기능이 있음`
  - 연결된 애플리케이션,ALB 등
- 일종의 `글로벌 ALB + AWS 인터넷 회선`서비스라고 생각

![Alt text](../../etc/image2/%EA%B8%80%EB%A1%9C%EB%B2%8C%EC%95%85%EC%84%B8%EB%A0%88%EC%9D%B4%ED%84%B0.png)



클라우드프론트랑 차이점은?
- 클라우드프론트
  - 다이나믹한 컨텐츠 제공
  - 캐시를 사용한 지연시간 최적화
  - 가끔식 오리진(`원본`)에서 `자료 참조함`(캐싱하기위해)
- 글로벌 악셀
  - 지속적으로 에지로케이션 사용 (`캐싱방식이 아님`)
  - TCP, UDP상의 다양한 애플리케이션 성능 향상
  - 따라서, 게임이나 Iot, 같은 `비 HTTP`서비스에 적합, (그렇다고 HTTP에 안좋다는건 아님)
  - 

























