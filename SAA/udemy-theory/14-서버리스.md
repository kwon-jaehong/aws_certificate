- SAA 시험은 서버리스 관련 내용 비중이 적음 
- Faas임 (funtion as a service)




----------------------------
## AWS Lambda

- `글로벌 서비스 아님` (리전기반임)
- 코드 실행시간이 짧음
- AWS `전체 서비스와 통합`됨
- `이벤트 기반`임 -> 어떤 일이 일어났을때에만 내가 작성한 람다 함수가 작동함
- 코드 실행시간 최대 `15분`
- 많은 언어 지원 + 람다 컨테이너 이미지를 지원, 클라우드 와치로 쉽게 볼 수 잇음
  - 람다에 컨테이너를 실행해야되는 경우, 컨테이너가 `Lambda 런타임 API를 구현 해야됨`
- 함수당 `10기가 최대 램`을 사용할수있음
- 기본적으로 `컨테이너 이미지` 위에서 작동함
- 오토스케일링 적용 -> 갑자기 같은 람다호출이 많아지면, 실행되는 람다 자원이 오토스케일링 됨

`람다 가격`
- API 콜
  - 처음 100만개는 무료
  - 이후에 백만개당 0.2달러

<br>
- 람다 진행 비용 (1초당/월단위)
  - 400,000 기가바이트 컴퓨팅까지는 무료
  - 1기가 램을 사용한다면 400,000초까지는 무료
  - 128mb 램을 사용하면 3,200,000까지는 무료
  - 이후 600,000 기가 - 초 까지 1달러 지불


`시험에서는 호출과 시간에 따른 가격을 알아야 한다!!!!!!!`


<br>
<br>

람다 제한 사항
- 이 제한사항은 `리전당 존재`
  - 실행한도
      - 메모리 (128MB ~ 10GB 1MB가씩 증가함)
      - 코드 실행시간 15분
      - 환경변수는 4Kb
      - 임시 DISK는 512MB ~ 10GB까지 (/tmp라는 디렉터리)
      - 최대 `1000개`까지 동시 실행 가능
  - 람다 코드 배포한도
    - 압축시 최대 크기는 50MB 
    - 압축하지 않았을때는 250MB (code + 종속성)
    - 시작할때 크기가 큰파일이 있으면, `/tmp 디렉터리` 사용해야됨



------------------------------------
## AWS Lambda@edge & cloudfront funtions

- 엣지 로케이션에서 실행되는 함수를 `edge funtion`이라 한다
- cloudfront랑 연결 가능함
- 지연시간을 최소화하는것이 목적


- 일반 Lambda랑 다르게 `글로벌 서비스`임
- cloudfront은 두가지 함수를 제공한다
  - cloudfront funtions
    - `javascript`로 작성된 경량함수
    - 초당 백만개 처리가능
    - `뷰어 요청과 응답을 수정`할 때만 사용
    - cloudfront의 네이티브 기능이며, cloudfront에서 코드 관리 가능함
    - 최대 1ms 실행시간
    - 사용 예시
      - 캐시 키 정규화
      - 요청/응답 헤더 수정
      - URL 수정 및 리다이렉션
      - 요청을 허용/거부
      - JWT 검증

![Alt text](../../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%84%EB%A1%A0%ED%8A%B8%EB%9E%8C%EB%8B%A41.png)


  - Lambda@edge
    - Node.js 나 파이썬 지원
    - 초당 수천개 처리
    - 모든 cloudfront 요청 및 응답을 변경 가능
    - 함수는 `us-east-1` 리전에만 작성 가능
    - 최대 10초 실행시간
    


![Alt text](../../etc/image2/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%84%EB%A1%A0%ED%8A%B8%EB%9E%8C%EB%8B%A42.png)

-------------------------------------------
## AWS lambda in VPC

- 람다는 기본적으로 VPC 외부에서 실행됨
- 따라서, 람다함수는 `VPC 내 리소스에 대한 엑세스를 할 수 없음`
- 람다를 VPC안에 생성 할 수 있는 기능
  - 대신, 람다 함수에 `서브넷 지정,보안그룹 추가`
  - ENI를 통해 가능

![Alt text](../../etc/image2/%EB%9E%8C%EB%8B%A4%EC%9D%B8VPC.png)



RDS 프록시와도 잘맞음
- 대량의 커넥터를 RDS 프록시가 `한곳으로 모아줌`

![Alt text](../../etc/image2/%EB%9E%8C%EB%8B%A4%ED%94%84%EB%A1%9D%EC%8B%9C.png)


---------------------------------
## AWS DynamoDB



- `완전 관리형, 고가용성, NO SQL`
- 기본적으로` 3개의 AZ에` 걸쳐 복제본을 두고 운영됨
`데이터가 내부에 분산된` 데이터베이스임
- 즉, RDB나 엘라스틱 캐시처럼 `서버를 프로비저닝할 필요가 없다`
- 시험 문제는 `저지연시간, 서버리스 디비`로 나오면 무조건 다이나모 디비임
- 보안,인증 관리가 IAM과 통합되어 있고, 오토 스케일링 기능을 갖추고 있음
- 검색 지연 시간이 한자릿수 밀리초임
- 초당 수백만 건의 요청 조단위가 넘는행을 신속하고 한결같은 성능을 보장함
- s3처럼 infrequent access (IA), `DynamoDB-IA` 테이블 클래스를 통해 비용 절감을 할 수 있음
- 아이템 최대 크기는 `400Kb` -> 큰 객체를 저장할때는 적합하지 않음
- nosql의 특징답게, 빠르게 스키마 전개 가능



다이나모 DB 모드
- provisioned mod
  - 미리 용량을 계획하고, 프로비저닝된 읽기/쓰기 만큼 비용 지불 (저렴)
- on-demand mod
  - 미리 용량 계획 X 
  - 정확히 사용한 만큼 비용 지불 (비쌈)
  - 워크로드를 예측할 수 없거나
  - 급격히 증가하는 유저가 있을때 유용



DynamoDB Accelerator (DAX)
- 다이나모DB + 엘라스틱 캐시
- `읽기 요청`이 많을때 사용
- 캐시에 `TTL` 있음



DynamoDB Stream Processing ---- (키네시스 데이터 스트림과 비슷)
- 다이나모DB 스트림 처리
- `테이블 아이템의 수정(생성/업데이트/삭제)을 처리하는 기능`
  - 예)
    - 사용자 테이블에 새로운 사용자가 등록됐을때, 환영메일 보내기
    - 실시간 사용 분석
    - 리전간 복제
    - Dynamo DB 테이블 변경 사항에 대해, Lambda 함수를 실행 할 수 있음
    - 24시간 예약되고(안사라짐), `소비자 수가 제한됨`

![Alt text](../../etc/image2/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AA%A8DB%20%EC%8A%A4%ED%8A%B8%EB%A6%BC.png)



DynamoDB Global Tables
- 여러 리전간 복제가 가능한 테이블, 즉 `모든 리전에서 테이블을 읽고,쓸 수 있음`
- 예) US-East-1을 업데이트/쓰기 해도, AP-Southeast-2에 알아서 복제됨
- 글로벌 테이블을 활성화 하려면, `다이나모 스트림 활성화 해야됨`

![Alt text](../../etc/image2/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AA%A8DB%EA%B8%80%EB%A1%9C%EB%B2%8C%ED%85%8C%EC%9D%B4%EB%B8%94.png)




DynamoDB Time to Live (TTL)
- `만료타임 있으면, 자동적으로 항목 삭제`

![Alt text](../../etc/image2/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AA%A8DBTTL.png)




DynamoDB Backups for disaster(재해) recovery - 백업 및 재해 복구

- 지정시간 복구 (PITR - point in time recovery)
  - 옵션 활성화 하면, `최대 35일`까지 가능
  - 복구를 할경우, 새 테이블이 생성
- on-demand backup
  - 풀 백업, `내가 삭제할떄까지 유지`
  - 백업 진행시 `성능에 영향 X`
  - AWS backup과 연동 가능
  - 복구를 할경우, 새 테이블이 생성
- S3 연동
  - 지정시간 복구를 활성화 하면, `S3에 저장 가능`
  - S3에서 CSV,Json파일을 기반으로 `import 할 수도` 있음



----------------------------------------------------------
## AWS API GATEWAY
- 서버리스 REST API 서비스
- 인증,사용량 계획 등 많은 기능 지원
- swagger나 OPENAPI 문서 자동 생성
- HTTP, REST, `WEB 소켓` 방식 생성 가능
  - REST 및 HTTP API와 달리 `WebSocket API는 양방향 통신을 허용`합니다. WebSocket API는 채팅 애플리케이션, 협업 플랫폼, 멀티플레이어 게임 및 금융 거래 플랫폼 같은 실시간 애플리케이션에서 자주 사용합니다.
- 배포방법
  - `edge-optimized(기본값)`
    - 모든 요청이 `클라우드프론트 엣지 로케이션을` 통해 들어옴(낮은 지연시간)
    -  API Gateway는 여전히 `하나의 AWS 리전에 존재`합니다.
  - Regional
    - 클라우드프론트 엣지로케이션 사용 X
    - 모든 사용자는 게이트웨이와 같은 리전에 있을 경우 사용
    - `클라우드프론트 부분 설정` 가능함
  - private
    - VPC 내에서만 엑세스 가능 (ENI사용해서)


API GATEWAY security (게이트웨이 보안)
- IAM 역활을 통해 접근 가능
- 코그니토
- HTTPS 보안을 통해

- 작동방법은, 원소스는 `Lambda 함수임`
- 람다 함수 정책에 API 게이트웨이 추가해줘야함

----------------------------------------
## AWS Step funtions

- 일종의 AWS 리소스 `파이프라인 시각화` 툴
- `병렬 실행, 실행 조건` 등 설정할 수 있음

![Alt text](../../etc/image2/%EC%8A%A4%ED%83%AD%ED%8E%91%EC%85%98.png)


-------------------------------------
## AWS cognito

- 모바일 / 웹에서 클라이언트들에게(AWS 외부에서) 인증 또는 자격 증명을 부여함
- 하위 서비스
  - cognito user polls
    - 앱 사용자에게 가입 기능 제공
    - API 게이트웨이, 로드밸런서와 통합 가능
    - 일종의 서버리스 `사용자 데이터 베이스`
      - 클라이언트 이름, 이메일, 비번 조합으로 로그인 정의
      - 패스워드 재설정, 이메일 및 전번 검증, MFA 설정 가능
      - 이걸로 `페북,구글,SAML 연계` 가능
  
  - cognito identity polls (federated identity)
    - 앱 등록 사용자에게, `임시 AWS 자격 증명 제공`
    - AWS 리소스에 `직접 엑세스` 할 수 있도록 해줌
    - user polls과 통합해서 사용가능
    - 임시 자격증명은, 사전에 코그니토 풀 서비스에 사전 정의 되있어야함
    - 클라이언트가 코그니토에 토큰을 보내면, 코그니토는 임시자격 증명과 교환해줌
  
![Alt text](../../etc/image2/%EC%BD%94%EA%B7%B8%EB%8B%88%ED%86%A0.png)










